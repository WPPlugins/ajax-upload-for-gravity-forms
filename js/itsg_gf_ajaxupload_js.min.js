function itsg_ajaxupload_restore_input(e){var t=e.prev(),a=e.siblings(".progress"),_=e.siblings(".results"),s=e.siblings(".itsg_single_ajax_cancel"),i=e.siblings(".itsg_single_ajax_remove"),r=e.parent("div.has-advanced-upload");e.show(),t.val("").change(),a.remove(),_.remove(),s.remove(),i.remove(),r.addClass("itsg_ajax_upload_dropzone"),e.focus()}function itsg_ajaxupload_maybe_restore_buttons(e){window["itsg_gf_ajaxupload_uploading_"+e]||(jQuery("#gform_"+e+" .gform_next_button:visible").attr("value",window["itsg_gf_ajaxupload_next_value_"+e]),jQuery("#gform_"+e+" .gform_previous_button:visible").attr("value",window["itsg_gf_ajaxupload_previous_value_"+e]),jQuery("#gform_"+e+' .gform_button[type="submit"]:visible').attr("value",window["itsg_gf_ajaxupload_submit_value_"+e]),jQuery("#gform_"+e+" a.gform_save_link:not(.top_button):visible").text(window["itsg_gf_ajaxupload_save_value_"+e]))}function itsg_ajaxupload_remove_upload(e,t){var a=itsg_gf_ajaxupload_js_settings.ajax_url,_=itsg_gf_ajaxupload_js_settings.allowdelete,s=itsg_gf_ajaxupload_js_settings.form_id,i=itsg_gf_ajaxupload_js_settings.entry_user_id;if(""!=e&&"null"!=e&&void 0!=e&&"1"==_){var r=decodeURIComponent(e.split("/").pop().split("?").shift()),o={action:"itsg_ajaxupload_delete_file",file_name:r,form_id:s,entry_user_id:i};jQuery.ajax({url:a,type:"POST",data:o})}itsg_ajaxupload_restore_input(t)}function itsg_gf_ajaxupload_display_upload(e){var t=itsg_gf_ajaxupload_js_settings.thumbnail_enable,a=(parseInt(itsg_gf_ajaxupload_js_settings.thumbnail_width),itsg_gf_ajaxupload_js_settings.text_file),_=itsg_gf_ajaxupload_js_settings.text_new_window,s=itsg_gf_ajaxupload_js_settings.text_remove,i=(e.prev(),e.prev().val()),r=decodeURIComponent(i.split("/").pop().split("?").shift()),o=i,n=r.substr(r.lastIndexOf(".")+1).toLowerCase();if(("undefined"==typeof e.next(".results")||!e.next(".results").length)&&""!=i&&"null"!=i&&void 0!=i){e.after(jQuery("<div/>",{"class":"results"}).append(jQuery("<div/>",{"class":"results-bar results-bar-success"})));var l=e.next(".results"),u=e.next(".results").children().first(),g=jQuery.now();if(jQuery("<input/>",{"class":"button itsg_single_ajax_button itsg_single_ajax_remove",type:"button",value:s,"aria-describedby":"remove_"+g}).append(jQuery("<span/>",{id:"remove_"+g,"class":"sr-only",text:s+" "+a+" "+r})).insertAfter(e.next(".results")).click(function(){itsg_ajaxupload_remove_upload(i,e),jQuery(this).remove()}),e.hide(),l.show(),"undefined"!=typeof r&&r.length>30)var r=r.substring(0,30)+"...";if("1"==t&&"jpg"==n||"png"==n||"gif"==n||"jpeg"==n){var d=i.split("/").pop(),p=i.replace(d,"thumbnail/"+d),f="1"==itsg_gf_ajaxupload_js_settings.thumbnail_file_name_enable?r:"";u.append(jQuery("<a/>",{href:o,target:"_blank","class":"thumbnail-link",title:_}).append(jQuery("<img/>",{src:p,"class":"thumbnail",onerror:"if (this.src != '"+o+"') this.src = '"+o+"';",alt:r,title:r})).append(jQuery("<div/>",{"class":"itsg_ajax_upload_file_name",text:f}))),e.parent("td.gfield_list_cell").css("width","200px"),l.addClass("done-thumbnail")}else u.append(jQuery("<a/>",{href:o,target:"_blank",alt:r,title:_,text:r})),l.addClass("done");u.find("a").focus()}}function itsg_gf_ajaxupload_init(){var e=itsg_gf_ajaxupload_js_settings.ajax_url,t=parseInt(itsg_gf_ajaxupload_js_settings.file_size_kb),a=itsg_gf_ajaxupload_js_settings.file_types,_=itsg_gf_ajaxupload_js_settings.text_not_accepted_file_type,s=itsg_gf_ajaxupload_js_settings.text_file_size_too_big,i=itsg_gf_ajaxupload_js_settings.text_uploading,r=itsg_gf_ajaxupload_js_settings.text_error_title,o=itsg_gf_ajaxupload_js_settings.displayscripterrors,n=itsg_gf_ajaxupload_js_settings.text_complete,l=itsg_gf_ajaxupload_js_settings.text_cancel,u=(itsg_gf_ajaxupload_js_settings.text_remove,itsg_gf_ajaxupload_js_settings.thumbnail_enable,parseInt(itsg_gf_ajaxupload_js_settings.file_chunk_size)),g=(itsg_gf_ajaxupload_js_settings.form_id,itsg_gf_ajaxupload_js_settings.user_id),d=itsg_gf_ajaxupload_js_settings.entry_user_id,p=itsg_gf_ajaxupload_js_settings.text_error_0,f=itsg_gf_ajaxupload_js_settings.text_error_404,j=itsg_gf_ajaxupload_js_settings.text_error_500,x=itsg_gf_ajaxupload_js_settings.text_error_parse,v=itsg_gf_ajaxupload_js_settings.text_error_timeout,m=itsg_gf_ajaxupload_js_settings.text_error_uncaught,c=itsg_gf_ajaxupload_js_settings.text_file,y=e,b=0;jQuery("input.itsg_ajax_upload_browse").each(function(){var e=jQuery(this).parents("form").attr("id").split("_").pop().trim();jQuery(this).fileupload({maxNumberOfFiles:1,singleFileUploads:!1,dropZone:jQuery(this).parent(".itsg_ajax_upload_dropzone"),maxChunkSize:u,url:y,dataType:"json",progressInterval:"500",add:function(r,o){if("undefined"!=typeof o.files&&o.files.length>1)return alert(itsg_gf_ajaxupload_js_settings.text_only_one_file_message),!1;if("undefined"!=typeof jQuery(this).siblings(".results")&&jQuery(this).siblings(".results").length>=1)return!1;var n=jQuery(this),u=o.originalFiles[0].name;if(itsg_gf_ajaxupload_js_settings.apostrophe_error_enable&&u.indexOf("'")>=0)return alert(itsg_gf_ajaxupload_js_settings.text_apostrophe_error_message),!1;jQuery(document).on("click",".delete_list_item",function(){var e=jQuery(this).parents("tr.gfield_list_group, tr.gfield_list_row_even, tr.gfield_list_row_odd");itsg_gf_ajaxupload_remove_list_item(e)});var g=[],d=new RegExp("(.|/)("+a+")$","i");if(d.test(u)||g.push(_),o.originalFiles[0].size>t&&(console.log(o.originalFiles[0].size),g.push(s)),"undefined"!=typeof g&&g.length>0)alert(g.join("\n"));else{jQuery.blueimp.fileupload.prototype.options.add.call(this,r,o),o.submit(),n.hide(),window["itsg_gf_ajaxupload_uploading_"+e]||(window["itsg_gf_ajaxupload_next_value_"+e]=jQuery("#gform_"+e+" .gform_next_button:visible").attr("value"),window["itsg_gf_ajaxupload_previous_value_"+e]=jQuery("#gform_"+e+" .gform_previous_button:visible").attr("value"),window["itsg_gf_ajaxupload_submit_value_"+e]=jQuery("#gform_"+e+' .gform_button[type="submit"]:visible').attr("value"),window["itsg_gf_ajaxupload_save_value_"+e]=jQuery("#gform_"+e+" a.gform_save_link:not(.top_button):visible").text()),window["itsg_gf_ajaxupload_uploading_"+e]=!0,jQuery("#gform_"+e+" .gform_next_button:visible").attr("value",i),jQuery("#gform_"+e+" .gform_previous_button:visible").attr("value",i),jQuery("#gform_"+e+' .gform_button[type="submit"]:visible').attr("value",i),jQuery("#gform_"+e+" a.gform_save_link:not(.top_button):visible").text(i);var p=jQuery.now();jQuery("<input/>",{"class":"button itsg_single_ajax_button itsg_single_ajax_cancel",type:"button",value:l,"aria-describedby":"cancel_"+p}).append(jQuery("<span/>",{id:"cancel_"+p,"class":"sr-only",text:l+" "+i+" "+c+" "+u})).insertAfter(n).click(function(){o.abort(),jQuery(this).remove(),itsg_ajaxupload_maybe_restore_buttons(e)}),n.after(jQuery("<div/>",{"class":"progress uploading"}).append(jQuery("<div/>",{"class":"progress-bar progress-bar-striped active",role:"progressbar","aria-valuemin":"0","aria-valuemax":"100"}).append(jQuery("<span/>",{"class":"sr-only"}))))}},done:function(t,a){window["itsg_gf_ajaxupload_uploading_"+e]=!1;var _=jQuery(this);jQuery.each(a.result.files,function(e,t){return t.error?(alert(t.error),void itsg_ajaxupload_restore_input(_)):(_.prev().val(t.url).change(),_.next().remove(),itsg_gf_ajaxupload_display_upload(_),_.parent().find(".itsg_single_ajax_cancel").remove(),void _.parent(".itsg_ajax_upload_dropzone").removeClass("itsg_ajax_upload_dropzone"))}),itsg_ajaxupload_maybe_restore_buttons(e)},error:function(t,a,_){window["itsg_gf_ajaxupload_uploading_"+e]=!1,"[object HTMLInputElement]"!=_&&"[object HTMLImageElement]"!=_&&"[object Object]"!=_&&"abort"!=_&&(0===t.status?error_message=p:404==t.status?error_message=f:500==t.status?error_message=j:"parsererror"===a?error_message=x:"timeout"===a?error_message=v:error_message=m+t.responseText,"1"==o?alert(r+"\n\n"+_+"\n\n"+error_message):alert(r),console.log(r+" "+_+" "+error_message))},progress:function(e,t){var a=parseInt(t.loaded/t.total*100,10);jQuery(this).next().children().first().attr("aria-valuenow",a),jQuery(this).next().children().first().css("width",a+"%"),jQuery(this).next().children().first().attr("aria-valuetext",a+"% "+n),jQuery(this).next().find("span.sr-only").text(a+"% "+n),"100"==a&&jQuery(this).next().addClass("100"),b+=1},fail:function(e,t){var a=jQuery(this);itsg_ajaxupload_restore_input(a)}}).on({fileuploadsubmit:function(e,t){t.formData={action:"itsg_ajaxupload_upload_file",field_id:jQuery(this).prev().attr("name").split("_").pop().trim().replace("[]",""),user_id:g,form_id:jQuery(this).closest("form").attr("id").split("_").pop().trim(),entry_user_id:d}}})})}function maybePreventDefault(e){var t=e.data.form_id;window["itsg_gf_ajaxupload_uploading_"+t]&&(jQuery(".gform_ajax_spinner").hide(),e.preventDefault())}function itsg_gf_ajaxupload_setup_dropzone_function(){jQuery(document).bind("drop dragover",function(e){return!1});var e=function(){var e=document.createElement("div");return("draggable"in e||"ondragstart"in e&&"ondrop"in e)&&"FormData"in window&&"FileReader"in window}(),t=jQuery(".itsg_ajax_upload_dropzone");e&&t.addClass("has-advanced-upload"),e&&t.on("dragover dragenter",function(){var e=jQuery(this).find("input.itsg_ajax_upload_browse");"undefined"!=typeof e.siblings(".results")&&e.siblings(".results").length<1&&jQuery(this).addClass("is-dragover")}).on("dragleave dragend drop",function(){jQuery(this).removeClass("is-dragover")})}function itsg_gf_ajaxupload_add_list_item(e){jQuery(e).find("input.itsg_ajax_upload_browse").each(function(){var e=jQuery(this);e.unbind().fileupload(),e.fileupload("destroy"),itsg_ajaxupload_restore_input(e)}),itsg_gf_ajaxupload_init()}function itsg_gf_ajaxupload_remove_list_item(e){jQuery(e).find("input.itsg_ajax_upload_browse").each(function(){var e=jQuery(this),t=jQuery(this).prev().val();itsg_ajaxupload_remove_upload(t,e)})}window.onerror=function(e,t,a){var _=itsg_gf_ajaxupload_js_settings.text_error,s=itsg_gf_ajaxupload_js_settings.text_line_number,i=itsg_gf_ajaxupload_js_settings.displayscripterrors;return console.log(_+":  "+e+" URL: "+t+" "+s+": "+a),"1"==i&&alert(_+": \n"+e+"\nURL: "+t+"\n"+s+": "+a),!0},"1"==itsg_gf_ajaxupload_js_settings.is_entry_detail?jQuery(document).ready(function(e){itsg_gf_ajaxupload_init(),itsg_gf_ajaxupload_setup_dropzone_function(),jQuery("input.itsg_ajax_upload_browse").each(function(){var e=jQuery(this);itsg_gf_ajaxupload_display_upload(e)}),jQuery(".gfield_list").on("click",".add_list_item",function(){var e=jQuery(this).parents("tr.gfield_list_group, tr.gfield_list_row_even, tr.gfield_list_row_odd").next("tr.gfield_list_group, tr.gfield_list_row_even, tr.gfield_list_row_odd");itsg_gf_ajaxupload_add_list_item(e)})}):jQuery(document).bind("gform_post_render",function(e){itsg_gf_ajaxupload_init(),itsg_gf_ajaxupload_setup_dropzone_function(),jQuery("input.itsg_ajax_upload_browse").each(function(){var e=jQuery(this);itsg_gf_ajaxupload_display_upload(e)}),jQuery(".gfield_list").on("click",".add_list_item",function(){var e=jQuery(this).parents("tr.gfield_list_group, tr.gfield_list_row_even, tr.gfield_list_row_odd").next("tr.gfield_list_group, tr.gfield_list_row_even, tr.gfield_list_row_odd");itsg_gf_ajaxupload_add_list_item(e)}),jQuery(".gform_wrapper form").each(function(){var e=jQuery(this).attr("id").split("_").pop().trim();jQuery(this).bind("submit",{form_id:e},maybePreventDefault)})});